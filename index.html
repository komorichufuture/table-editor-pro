<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¡¨ã‚¨ãƒ‡ã‚£ã‚¿ Pro - ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-attachment: fixed;
    }
    
    #app {
      min-height: 100vh;
      padding: 20px;
    }
    
    #controls {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    .btn.secondary {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      color: #744210;
    }
    
    .btn.danger {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
      color: white;
    }
    
    #tables-container {
      display: flex;
      flex-direction: column;
      gap: 30px;
    }
    
    .table-wrapper {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
    }
    
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .table-title {
      font-size: 18px;
      font-weight: bold;
      color: #4c51bf;
      background: rgba(102, 126, 234, 0.1);
      padding: 8px 15px;
      border-radius: 8px;
      border: none;
      outline: none;
    }
    
    .table-controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .table-controls .btn {
      font-size: 12px;
      padding: 6px 12px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    td {
      border: 2px solid rgba(102, 126, 234, 0.2);
      min-width: 120px;
      min-height: 80px;
      padding: 8px;
      text-align: center;
      vertical-align: middle;
      background: white;
      transition: all 0.2s ease;
      position: relative;
    }
    
    td:hover {
      background: rgba(102, 126, 234, 0.05);
      border-color: rgba(102, 126, 234, 0.4);
    }
    
    td[contenteditable="true"] {
      outline: none;
      cursor: text;
    }
    
    td[contenteditable="true"]:focus {
      background: rgba(102, 126, 234, 0.1);
      border-color: rgba(102, 126, 234, 0.6);
      box-shadow: inset 0 0 0 2px rgba(102, 126, 234, 0.3);
    }
    
    .placeholder {
      color: #999;
      font-style: italic;
      font-size: 14px;
    }
    
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
      z-index: 1000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    
    .toast.show {
      transform: translateX(0);
    }
    
    .toast.error {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
    }
    
    .file-input {
      display: none;
    }
    
    @media (max-width: 768px) {
      #app {
        padding: 10px;
      }
      
      #controls {
        padding: 15px;
      }
      
      .btn {
        font-size: 12px;
        padding: 10px 15px;
      }
      
      td {
        min-width: 80px;
        min-height: 60px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="controls">
      <button class="btn" onclick="createNewTable()">ğŸ“Š æ–°ã—ã„è¡¨</button>
      <button class="btn secondary" onclick="saveToLocalStorage()">ğŸ’¾ ä¿å­˜</button>
      <button class="btn secondary" onclick="loadFromLocalStorage()">ğŸ“‚ å¾©å…ƒ</button>
      <button class="btn" onclick="exportToJSON()">ğŸ“¤ JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
      <button class="btn" onclick="importFromJSON()">ğŸ“ JSONã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
      <button class="btn danger" onclick="clearAllTables()">ğŸ—‘ï¸ å…¨å‰Šé™¤</button>
    </div>
    
    <div id="tables-container">
      <!-- è¡¨ãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹ -->
    </div>
  </div>

  <div id="toast" class="toast"></div>
  <input type="file" id="json-file-input" class="file-input" accept=".json">

  <script>
    let tableCount = 0;
    let tables = [];

    // ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type} show`;
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // æ–°ã—ã„è¡¨ã‚’ä½œæˆ
    function createNewTable() {
      try {
        tableCount++;
        const tableId = `table-${Date.now()}`;
        
        const tableData = {
          id: tableId,
          title: `è¡¨ ${tableCount}`,
          rows: [
            ['', '', ''],
            ['', '', ''],
            ['', '', '']
          ]
        };
        
        tables.push(tableData);
        renderTable(tableData);
        showToast('ğŸ“Š æ–°ã—ã„è¡¨ã‚’ä½œæˆã—ã¾ã—ãŸ');
        console.log('æ–°ã—ã„è¡¨ã‚’ä½œæˆ:', tableData);
      } catch (error) {
        console.error('è¡¨ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
        showToast('è¡¨ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    // è¡¨ã‚’HTMLã«æç”»
    function renderTable(tableData) {
      try {
        const container = document.getElementById('tables-container');
        
        const wrapper = document.createElement('div');
        wrapper.className = 'table-wrapper';
        wrapper.setAttribute('data-table-id', tableData.id);
        
        // ãƒ˜ãƒƒãƒ€ãƒ¼
        const header = document.createElement('div');
        header.className = 'table-header';
        
        const titleInput = document.createElement('input');
        titleInput.className = 'table-title';
        titleInput.value = tableData.title;
        titleInput.addEventListener('input', function() {
          updateTableTitle(tableData.id, this.value);
        });
        
        const controls = document.createElement('div');
        controls.className = 'table-controls';
        controls.innerHTML = `
          <button class="btn" onclick="addRow('${tableData.id}')">â• è¡Œ</button>
          <button class="btn" onclick="addColumn('${tableData.id}')">â• åˆ—</button>
          <button class="btn danger" onclick="removeRow('${tableData.id}')">â– è¡Œ</button>
          <button class="btn danger" onclick="removeColumn('${tableData.id}')">â– åˆ—</button>
          <button class="btn danger" onclick="deleteTable('${tableData.id}')">ğŸ—‘ï¸ å‰Šé™¤</button>
        `;
        
        header.appendChild(titleInput);
        header.appendChild(controls);
        wrapper.appendChild(header);
        
        // ãƒ†ãƒ¼ãƒ–ãƒ«
        const table = document.createElement('table');
        table.id = `table-${tableData.id}`;
        
        for (let i = 0; i < tableData.rows.length; i++) {
          const tr = document.createElement('tr');
          for (let j = 0; j < tableData.rows[i].length; j++) {
            const td = document.createElement('td');
            td.setAttribute('contenteditable', 'true');
            td.setAttribute('data-row', i);
            td.setAttribute('data-col', j);
            
            if (tableData.rows[i][j]) {
              td.innerHTML = tableData.rows[i][j];
            } else {
              td.innerHTML = '<span class="placeholder">ã‚¯ãƒªãƒƒã‚¯ã—ã¦å…¥åŠ›</span>';
            }
            
            // ã‚»ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆ
            td.addEventListener('focus', function() {
              if (this.innerHTML.includes('placeholder')) {
                this.innerHTML = '';
              }
            });
            
            td.addEventListener('blur', function() {
              const row = parseInt(this.getAttribute('data-row'));
              const col = parseInt(this.getAttribute('data-col'));
              updateCellData(tableData.id, row, col, this.innerHTML);
              
              if (!this.innerHTML.trim()) {
                this.innerHTML = '<span class="placeholder">ã‚¯ãƒªãƒƒã‚¯ã—ã¦å…¥åŠ›</span>';
              }
            });
            
            td.addEventListener('keydown', function(e) {
              if (e.key === 'Enter') {
                e.preventDefault();
                document.execCommand('insertHTML', false, '<br>');
              }
            });
            
            tr.appendChild(td);
          }
          table.appendChild(tr);
        }
        
        wrapper.appendChild(table);
        container.appendChild(wrapper);
        
        console.log('è¡¨ã‚’æç”»å®Œäº†:', tableData.id);
      } catch (error) {
        console.error('è¡¨æç”»ã‚¨ãƒ©ãƒ¼:', error);
        showToast('è¡¨ã®æç”»ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    // ã‚»ãƒ«ãƒ‡ãƒ¼ã‚¿æ›´æ–°
    function updateCellData(tableId, row, col, content) {
      try {
        const table = tables.find(t => t.id === tableId);
        if (table && table.rows[row]) {
          table.rows[row][col] = content;
        }
      } catch (error) {
        console.error('ã‚»ãƒ«ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // è¡¨ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
    function updateTableTitle(tableId, title) {
      try {
        const table = tables.find(t => t.id === tableId);
        if (table) {
          table.title = title;
        }
      } catch (error) {
        console.error('ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // è¡Œè¿½åŠ 
    function addRow(tableId) {
      try {
        const table = tables.find(t => t.id === tableId);
        if (table) {
          const colCount = table.rows[0].length;
          const newRow = new Array(colCount).fill('');
          table.rows.push(newRow);
          refreshTable(tableId);
          showToast('è¡Œã‚’è¿½åŠ ã—ã¾ã—ãŸ');
        }
      } catch (error) {
        console.error('è¡Œè¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
        showToast('è¡Œã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    // åˆ—è¿½åŠ 
    function addColumn(tableId) {
      try {
        const table = tables.find(t => t.id === tableId);
        if (table) {
          table.rows.forEach(row => row.push(''));
          refreshTable(tableId);
          showToast('åˆ—ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
        }
      } catch (error) {
        console.error('åˆ—è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
        showToast('åˆ—ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    // è¡Œå‰Šé™¤
    function removeRow(tableId) {
      try {
        const table = tables.find(t => t.id === tableId);
        if (table && table.rows.length > 1) {
          table.rows.pop();
          refreshTable(tableId);
          showToast('è¡Œã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }
      } catch (error) {
        console.error('è¡Œå‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // åˆ—å‰Šé™¤
    function removeColumn(tableId) {
      try {
        const table = tables.find(t => t.id === tableId);
        if (table && table.rows[0].length > 1) {
          table.rows.forEach(row => row.pop());
          refreshTable(tableId);
          showToast('åˆ—ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }
      } catch (error) {
        console.error('åˆ—å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // è¡¨å‰Šé™¤
    function deleteTable(tableId) {
      try {
        if (confirm('ã“ã®è¡¨ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          tables = tables.filter(t => t.id !== tableId);
          const wrapper = document.querySelector(`[data-table-id="${tableId}"]`);
          if (wrapper) {
            wrapper.remove();
          }
          showToast('è¡¨ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }
      } catch (error) {
        console.error('è¡¨å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // è¡¨ã‚’å†æç”»
    function refreshTable(tableId) {
      try {
        const wrapper = document.querySelector(`[data-table-id="${tableId}"]`);
        const table = tables.find(t => t.id === tableId);
        if (wrapper && table) {
          wrapper.remove();
          renderTable(table);
        }
      } catch (error) {
        console.error('è¡¨å†æç”»ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    function saveToLocalStorage() {
      try {
        localStorage.setItem('tableEditorData', JSON.stringify(tables));
        localStorage.setItem('tableEditorSaveTime', new Date().toISOString());
        showToast('ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
        console.log('ä¿å­˜å®Œäº†:', tables);
      } catch (error) {
        console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        showToast('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å¾©å…ƒ
    function loadFromLocalStorage() {
      try {
        const savedData = localStorage.getItem('tableEditorData');
        if (savedData) {
          tables = JSON.parse(savedData);
          document.getElementById('tables-container').innerHTML = '';
          tables.forEach(table => renderTable(table));
          tableCount = tables.length;
          showToast('ğŸ“‚ ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ');
          console.log('å¾©å…ƒå®Œäº†:', tables);
        } else {
          showToast('ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
        }
      } catch (error) {
        console.error('å¾©å…ƒã‚¨ãƒ©ãƒ¼:', error);
        showToast('ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    // JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    function exportToJSON() {
      try {
        if (tables.length === 0) {
          showToast('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹è¡¨ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
          return;
        }
        
        const exportData = {
          version: '1.0',
          exportDate: new Date().toISOString(),
          tables: tables
        };
        
        const blob = new Blob([JSON.stringify(exportData, null, 2)], {
          type: 'application/json'
        });
        
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `table-data-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showToast('ğŸ“¤ JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
        console.log('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†:', exportData);
      } catch (error) {
        console.error('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
        showToast('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    // JSONã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    function importFromJSON() {
      try {
        const fileInput = document.getElementById('json-file-input');
        fileInput.click();
      } catch (error) {
        console.error('ã‚¤ãƒ³ãƒãƒ¼ãƒˆé–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
        showToast('ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ™‚ã®å‡¦ç†
    document.getElementById('json-file-input').addEventListener('change', function(e) {
      try {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(event) {
          try {
            const importData = JSON.parse(event.target.result);
            const importTables = importData.tables || importData;
            
            if (confirm('æ—¢å­˜ã®è¡¨ã‚’å‰Šé™¤ã—ã¦æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã‹ï¼Ÿ')) {
              tables = importTables;
              document.getElementById('tables-container').innerHTML = '';
              tables.forEach(table => renderTable(table));
              tableCount = tables.length;
              showToast(`ğŸ“ ${tables.length}å€‹ã®è¡¨ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
              console.log('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†:', tables);
            }
          } catch (error) {
            console.error('JSONè§£æã‚¨ãƒ©ãƒ¼:', error);
            showToast('JSONãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“', 'error');
          }
        };
        
        reader.onerror = function() {
          showToast('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        };
        
        reader.readAsText(file);
        
        // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆ
        e.target.value = '';
      } catch (error) {
        console.error('ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
        showToast('ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    });

    // å…¨å‰Šé™¤
    function clearAllTables() {
      try {
        if (confirm('ã™ã¹ã¦ã®è¡¨ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
          tables = [];
          tableCount = 0;
          document.getElementById('tables-container').innerHTML = '';
          localStorage.removeItem('tableEditorData');
          localStorage.removeItem('tableEditorSaveTime');
          showToast('ğŸ—‘ï¸ ã™ã¹ã¦ã®è¡¨ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }
      } catch (error) {
        console.error('å…¨å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
    window.addEventListener('load', function() {
      try {
        showToast('ğŸš€ è¡¨ã‚¨ãƒ‡ã‚£ã‚¿ãŒèµ·å‹•ã—ã¾ã—ãŸ');
        
        // è‡ªå‹•ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        setTimeout(() => {
          const savedData = localStorage.getItem('tableEditorData');
          if (savedData) {
            const saveTime = localStorage.getItem('tableEditorSaveTime');
            const timeStr = saveTime ? new Date(saveTime).toLocaleString() : 'ä¸æ˜';
            if (confirm(`å‰å›ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™ (${timeStr})ã€‚å¾©å…ƒã—ã¾ã™ã‹ï¼Ÿ`)) {
              loadFromLocalStorage();
            }
          }
        }, 1000);
        
        console.log('ã‚¢ãƒ—ãƒªåˆæœŸåŒ–å®Œäº†');
      } catch (error) {
        console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
      }
    });

    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 'n':
            e.preventDefault();
            createNewTable();
            break;
          case 's':
            e.preventDefault();
            saveToLocalStorage();
            break;
        }
      }
    });

    // ãƒ‡ãƒãƒƒã‚°ç”¨
    window.debugTables = function() {
      console.log('ç¾åœ¨ã®è¡¨ãƒ‡ãƒ¼ã‚¿:', tables);
      console.log('è¡¨ã®æ•°:', tables.length);
    };
  </script>
</body>
</html>
